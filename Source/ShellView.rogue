#================================================================================
# ShellView.rogue
# November 14, 2021
#================================================================================

$requireRogue "1.9.6"

$include "ANSIBitmap.rogue"
$include "ANSIColor.rogue"
$include "ImageView.rogue"
$include "RGB.rogue"
$include "ShellViewUI.rogue"

uses Bitmap
uses UI/ConsoleUI
uses Utility/CommandLineParser

try
  ShellView.init( System.command_line_arguments )
catch (error:Error)
  Console.error.println error
  System.exit 1
endTry

class ShellView [singleton]
  PROPERTIES
    command : Value

  METHODS
    method init( args:String[] )
      command = parse_args( args )

      #trace command
      # has //options and possibly //args

      if (command//options//help or command//args.count == 0)
        print_usage
        System.exit 0
      endIf

      ShellViewUI.filepaths = command//args.to_list<<String>>
      ShellViewUI.filepaths.add( ShellViewUI.filepaths.remove_first )
      ShellViewUI.image_view.set_image( ShellViewUI.filepaths.last )

      ShellViewUI.run

      #local bmp = ANSIBitmap( Bitmap(File("~/Desktop/U5.bmp")) )
      #trace bmp.width, bmp.height
      #bmp.display


    method parse_args( args:String[] )->Value
      local command = CommandLineParser().
      [
        option( "--dither",   &alias="-d" )
        option( "--help",     &aliases=["-h","-?"] )
        option( "--setting=", &alias="-s" )
      ].parse( args )
      return command

    method print_usage
      println @|USAGE
               |  shellview [OPTIONS]
               |
               |OPTIONS
               |  --dither, -d
               |    Enable color dithering.
               |
               |  --help, -h, -?
               |    Show this help text.
endClass
